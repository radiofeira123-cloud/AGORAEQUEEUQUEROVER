<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cabine FotogrÃ¡fica - Operador</title>
  <!-- Socket.IO direto do CDN -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; }
    #qrcode { margin: 20px auto; }
    #photos img { width: 200px; margin: 10px; border: 2px solid #000; }
  </style>
</head>
<body>
  <h1>ðŸ“¸ Painel da Cabine</h1>
  <button id="btnNewSession">Gerar QR Code para Celular</button>
  <button id="btnEndSession" style="display:none;">Finalizar SessÃ£o</button>
  <div id="qrcode"></div>

  <h2>Fotos recebidas</h2>
  <div id="photos"></div>

  <script>
    const socket = io(); // conecta no mesmo host do server
    let currentSession = null;

    const btnNew = document.getElementById("btnNewSession");
    const btnEnd = document.getElementById("btnEndSession");
    const qrcodeDiv = document.getElementById("qrcode");
    const photosDiv = document.getElementById("photos");

    btnNew.onclick = () => {
      socket.emit("create_session");
    };

    socket.on("session_created", sessionId => {
      currentSession = sessionId;
      qrcodeDiv.innerHTML = "";
      QRCode.toCanvas(
        `https://${window.location.host}/celular.html?session=${sessionId}`,
        { width: 200 },
        (err, canvas) => {
          if (!err) qrcodeDiv.appendChild(canvas);
        }
      );
      btnNew.style.display = "none";
      btnEnd.style.display = "inline-block";
      photosDiv.innerHTML = "";
    });

    socket.on("photos_ready", photos => {
      photosDiv.innerHTML = "";
      photos.forEach(p => {
        const img = document.createElement("img");
        img.src = p;
        photosDiv.appendChild(img);
      });
    });

    btnEnd.onclick = () => {
      if (currentSession) {
        socket.emit("end_session", currentSession);
        currentSession = null;
        qrcodeDiv.innerHTML = "";
        btnNew.style.display = "inline-block";
        btnEnd.style.display = "none";
        photosDiv.innerHTML = "";
      }
    };
  </script>
</body>
</html>
