<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cabine Fotográfica - Operador</title>
  <style>
    body { font-family: sans-serif; background: #222; color: white; padding: 20px; }
    img { max-width: 200px; margin: 10px; border: 2px solid white; border-radius: 10px; }
    button { margin: 10px; padding: 15px 25px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>Cabine Fotográfica - Operador</h1>
  <div>
    <button id="btnQRCell">Gerar QR Code Celular</button>
    <button id="btnUpload">Gerar & Enviar (IMGBB + QR Visualizador)</button>
    <button id="btnPrint">Imprimir (9x13)</button>
    <button id="btnReset">Finalizar Sessão</button>
  </div>
  <div id="photos"></div>
  <div id="qrcode"></div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script>
    const socket = io("https://agoraequeeuquerover.onrender.com");
    const photosDiv = document.getElementById("photos");
    let session = null;
    let photos = [];

    // Gerar QR pro celular
    document.getElementById("btnQRCell").onclick = () => {
      session = "sessao_" + Date.now();
      const url = window.location.origin + "/celular.html?session=" + session;
      QRCode.toCanvas(document.createElement("canvas"), url, (err, canvas) => {
        document.getElementById("qrcode").innerHTML = "";
        document.getElementById("qrcode").appendChild(canvas);
      });
    };

    socket.on("photos_from_cell", (data) => {
      session = data.session;
      photos = data.photos;
      photosDiv.innerHTML = "";
      photos.forEach(p => {
        let img = document.createElement("img");
        img.src = p;
        photosDiv.appendChild(img);
      });
    });

    // Gerar & Enviar
    document.getElementById("btnUpload").onclick = () => {
      if (!photos.length) return alert("Nenhuma foto recebida!");
      const url = window.location.origin + "/visualizador.html?session=" + session;
      QRCode.toCanvas(document.createElement("canvas"), url, (err, canvas) => {
        document.getElementById("qrcode").innerHTML = "";
        document.getElementById("qrcode").appendChild(canvas);
      });
    };

    // Imprimir
    document.getElementById("btnPrint").onclick = () => {
      if (!photos.length) return alert("Nenhuma foto recebida!");
      alert("Aqui vamos montar a moldura 9x13 e mandar imprimir!");
    };

    // Finalizar sessão
    document.getElementById("btnReset").onclick = () => {
      if (!session) return;
      socket.emit("reset_session", { session });
      photos = [];
      photosDiv.innerHTML = "";
      document.getElementById("qrcode").innerHTML = "";
      alert("Sessão finalizada!");
    };
  </script>
</body>
</html>
