<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cabine Fotogr√°fica - Celular</title>
  <style>
    body { margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: black; color: white; font-family: sans-serif; height: 100vh; }
    video, canvas { max-width: 100%; height: auto; border: 3px solid white; border-radius: 10px; }
    #btnFullscreen, #btnStart { padding: 15px 25px; font-size: 18px; margin: 10px; }
    #message { font-size: 32px; margin: 20px; }
  </style>
</head>
<body>
  <button id="btnFullscreen">Entrar em Tela Cheia</button>
  <button id="btnStart" style="display:none;">Clique aqui para Iniciar</button>
  <div id="message"></div>
  <video id="video" autoplay playsinline style="display:none;"></video>
  <canvas id="canvas" style="display:none;"></canvas>
  <audio id="clickSound" src="clack.mp3"></audio>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const socket = io("https://agoraequeeuquerover.onrender.com");
    const btnFullscreen = document.getElementById("btnFullscreen");
    const btnStart = document.getElementById("btnStart");
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const message = document.getElementById("message");
    const clickSound = document.getElementById("clickSound");

    let session = "sessao_" + Date.now(); // gera ID de sess√£o
    socket.emit("join_room", { session });

    btnFullscreen.onclick = () => {
      if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
      btnFullscreen.style.display = "none";
      btnStart.style.display = "inline-block";
    };

    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
        video.srcObject = stream;
        video.style.display = "block";
      } catch (err) {
        alert("Erro ao acessar c√¢mera: " + err);
      }
    }

    async function takePhotos() {
      let photos = [];
      const ctx = canvas.getContext("2d");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      for (let i = 0; i < 3; i++) {
        for (let t = 5; t > 0; t--) {
          message.innerText = (t <= 2 ? "Sorria!" : t);
          if (t === 2) clickSound.play();
          await new Promise(r => setTimeout(r, 1000));
        }
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const dataUrl = canvas.toDataURL("image/jpeg", 0.9);
        photos.push(dataUrl);
        message.innerText = "üì∏";
        await new Promise(r => setTimeout(r, 3000));
      }

      message.innerText = "Obrigado por utilizar a cabine!";
      socket.emit("photos_from_cell", { session, photos });
    }

    btnStart.onclick = async () => {
      btnStart.style.display = "none";
      await startCamera();
      takePhotos();
    };
  </script>
</body>
</html>
